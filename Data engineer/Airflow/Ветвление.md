[[Airflow]]
Для ветвления используются отдельные операторы
## BranchPythonOperator
Этот оператор принимает на вход функцию, которая *должна* возвращать строку-айди таски. 
```python
from airflow.operators.python import PythonOperator, BranchPythonOperator
from airflow.operators.bash import BashOperator
from airflow.operators.dummy import DummyOperator
from airflow import DAG
from datetime import datetime


dag = DAG(
    '0_Examples_5_1_3_branch_operator',
    schedule_interval=None,
    start_date=datetime(2024, 1, 1),
)

def branch_func(**kwargs):
    xcom_value = 10
    if xcom_value >= 5:
        return 'continue_task'
    else:
        return 'stop_task' 
        
start_op = BashOperator(
    task_id='start_task',
    bash_command="echo 10",    
    dag=dag)


branch_op = BranchPythonOperator(
    task_id='branch_task',
    python_callable=branch_func,
    provide_context=True,
    dag=dag)


continue_op = DummyOperator(task_id='continue_task', dag=dag)
stop_op = DummyOperator(task_id='stop_task', dag=dag)


start_op >> branch_op >> [continue_op, stop_op]
```
## ShortCircuitOperator
Если функция возвращает `True`, то выполнение последюущих задач продолжает, иначе нет
```python
from airflow import DAG
from airflow.models.baseoperator import chain
from airflow.operators.dummy import DummyOperator
from airflow.operators.python import ShortCircuitOperator
from airflow.utils import dates


with DAG(
    dag_id='0_Examples_5_1_4_short_circut_operator',
    start_date=dates.days_ago(2),
    schedule_interval=None,
    tags=['example'],
) as dag:

    cond_true = ShortCircuitOperator(
        task_id='condition_is_True',
        python_callable=lambda: True,
    )

    cond_false = ShortCircuitOperator(
        task_id='condition_is_False',
        python_callable=lambda: False,
    )
    
    cond_true1 = ShortCircuitOperator(
        task_id='condition_is_True1',
        python_callable=lambda: True,
    )

    cond_false1 = ShortCircuitOperator(
        task_id='condition_is_False1',
        python_callable=lambda: False,
    )
    
    cond_true2 = ShortCircuitOperator(
        task_id='condition_is_True2',
        python_callable=lambda: True,
    )

    cond_false2 = ShortCircuitOperator(
        task_id='condition_is_False2',
        python_callable=lambda: False,
    )


    chain(cond_true, cond_true1, cond_true2)
    chain(cond_false, cond_false1, cond_false2)
```
![[Pasted image 20250810093315.png]]
