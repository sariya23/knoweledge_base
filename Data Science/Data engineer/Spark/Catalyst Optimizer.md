[[Spark]]
Catalyst Optimizer - это оптимизатор sql like запросов в spark. Строится несколько планов
1. Построение логического плана. При построении логического плана говорится что должно быть выполнено, но не как
2. Оптимизация логического плана. После этот план оптимизируется. Применяются разные планы по оптимизации. Также есть Cost Based оптимизация (CBO), которая использует статистику данных для принятия решений. 
3. Создание физического плана. Планировщик на основе логического плана строит один или несколько физических планов. Физические планы уже описывают как запросы будут выполнятся. Дальше Catalyst выбирает из физических планов самый лучший (на основе стоимости выполнения)
```python
from pyspark.sql import SparkSession


spark = SparkSession.builder.appName("Catalyst Optimizer Example").getOrCreate()


data = [("Alice", 34), ("Bob", 45), ("Cathy", 29)]
df = spark.createDataFrame(data, ["Name", "Age"])


result = df.filter(df.Age > 30).select("Name", "Age").orderBy("Name")

result.explain(True)
```
Также как и в постгресе план запроса читается снизу вверх
![[Pasted image 20250802140557.png]]
- Parsed Logical Plan показывает первосозданный, неоптимизированный план. 
- Analyzed Logical Plan. На этом этапе Catalyst проверяет и анализирует изначальный логический план. Тут добавляется информация о типах данных и об айдишниках столбцов
- Optimized Logical Plan. Происходит оптимизация логического плана.
- Physical Plan. Конечный физический план