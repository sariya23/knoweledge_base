[[100 ошибок в Go и как их избежать]]

В новых версиях (то ли с 1.21, то ли с 1.22) такой проблемы уже нет.
```go
for _, i := range []int{1, 2, 3} {
	wg.Add(1)
	go func() {
		defer wg.Done()
		fmt.Println(i)
	}
}
wg.Wait()
```
Раньше переменная `i` не пересоздавалась на каждой итерации цикла, а значит ссылалась на одну и ту же ячейку в памяти. Поэтому могло выводится 3 раза последнее значение. Решалось это тем, что либо происходило затенение переменной в теле цикла:
```go
val := i
go func(){}()
```
Либо передавать передавать это значение как параметр:
```go
go func(i int){}()
```