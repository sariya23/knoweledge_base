[[Высоконагруженные приложения]]
Наибольшее значение в информационных системах имеют такие свойства:
- *Надежность*. Система должна работать корректно (выполнять свои функции на требуемом уровне производительности) даже при неблагоприятных обстоятельствах. 
- *Масштабируемость*. Должны быть предусмотрены разумные способы решения возникающих при росте проблем.
- *Удобство сопровождения*. Необходимо обеспечить возможность эффективной работы с системой множеству разных людей
## Надежность
Надежность в ПО:
- Приложение выполняет ожидаемую пользователем функцию
- Оно способно выдержать ошибочные действия пользователя или использование неожиданным образом
- Высокая производительность
- Система предотвращает любой несанкционированный доступ

Стоит заметить, что невозможно сделать систему устойчивой ко ВСЕМ видам сбоев. Система может быть устойчива только к *определенным видам сбоев*.

> [!Сбой]
> Сбой (fault) - отклонение одного из компонентов сисетмы от рабочих характеристик

> [!Отказ]
> Отказ (failure) - ситуация, когда система перестает работать

Снизить вероятнсть сбоев до нуля невозможно, следовательно лучше стремиться проектировать сисетму так, чтобы не возникало сбоев, переходящих в отказы. 
### Аппаратные сбои
Раньше, чтобы предотвращать аппаратные сбои, просто добавляли кучу резервных машин. Но как только данных становилось больше, то и машин становилось намного больше, а это вело к тому, что число отказов машин стремительно росло. ==Поэтому щас происходит сдвиг в сторону систем, способных перенести потерю целых машин, благодаря применению методов устойчивости к сбоям, вместо избыточности аппаратного обеспечения.== 
### Программные ошибки
Программные ошибки быстро не устранить, а также появится они могут, когда произойдет какое-то особенное событие в системе. 
### Человеческий фактор
Способы избежать человеческого фактора в системах:
- Проектирование систем так, чтобы минимизировать вероятность появления ошибки. Например, грамотные абстракции, интерфейсы, которые не позволяют слишком много, но и не слишком мало
- Предоставить среду-песочницу (стг контур), чтобы можно было безопасно изучать систему с реальными данными =
- Выполнять тщательное тестирование на всех уровнях. Начиная модульным (юнит автотесты), заканчивая ручным e2e
- Создать механизм восстановления после сбоев
- Настроить ясный мониторинг, так как он позволяет обнаружить проблемы в системе на раннем этапе.
### Насколько важна надежность
Надежность требуется и в коммерческий приложениях, так как идет работа с деньгами, и в простых, например, хранение фото.
## Масштабируемость

> [!Масштабируемость]
> Масштабируемость (scalability) - способность системы справлятся с возрастающей нагрузкой

### Описание нагрузки
Только после описания нагрузки на систему можно будет обсуждать вопросы связанные с ее ростом. Рассмотрим на примере Твиттера
- публикация твита - публикация нового сообщения для подписчиков (4600 RPS, пик 12k RPS)
- домашняя лента - просмотр твиты тех, на кого подписан пользователь (300k RPS)
Проблема тут в коэффициенте разветвления по выходу - каждый пользователь подписан на множество людей и сам имеет много подписчиков. 
Есть 2 способа реализации этих методов
- Публикация твита - просто инсерт в БД. Когда приходит запрос на чтение ленты, в БД происходит поиск всех людей, на кого он подписан и поиск их твитов
- Поддержка кэша ленты для каждого пользователя. При публикации твита он разлетается во все кэши подписчиков. Запрос на чтение становится малозатратным, так как все лежит в кэше
Мы имеем либо долгую вставку, либо долго чтение. Так как запросов на чтение в разы больше, то в твиттере стал применятся подход 2. Но сейчас даже происходит совмещение этих подходов, так как есть пользователи, у которых сотни миллионов подписчиков. Такие лица исключаются из списка и для них используется подход 1
### Описание производительности
После описании нагрузки, можно выяснять, что с ней произойдет
- Как изменится производительность системы, если увеличить параметр нагрузки на тех же ресурсах
- Насколько нужно увеличить ресурсы, чтобы производительность не изменилась
Рассмотрим на примере времени отклика. Часто смотрят на среднее значение. Но это не самая лучшая метрика. Обычно удобнее применять *процентили*. Если отсортировать список значений по возрастанию, то медиана - это 50 процентиль, то есть половина запросов отрабатывает меньше чем за 200с, а другая половина больше. 
Также можно обращать внимание и на более высокие процентили - p95, p99, p99.9. Например, если p95 равен 1.5с, значит 95 из 100 запросов занимают менее 1.5с, а 5 из 100 занимают 1.5с или дольше. 
В амазоне вообще смотрят на p99.9x, так как если запрос долгий, значит у юзера много данных, а значит он ценный клиент.
Но упарываться не стоит. Оптимизация по p99.99 слишком дорогостоящей и не приносящий много пользы
### Как справиться с нагрузкой
Применяют вертикальное масштабирование (добавление мощности) и горизонтальное (добавление новых машин для обработки запросов)
При высокой рабочей нагрузке часто нельзя обойтись без горизонтального масштабирование. На практике хорошая архитектура включает в себя оба этих подхода

==Не сущесвует такой вещи, как одна масштабируема архитектура на все случаи жизни==

==Хорошая масштабируемая для конкретного приложения архитектура базируется на допущениях о том, какие операции будут выполнятся часто, а какие - редко, то есть на параметрах нагрузки==

## Удобство сопровождения
Есть 3 принципа проектирования систем для удобного сопровождения:
- Удобство эксплуатации
- Простота
- Возможность развития
### Удобство эксплуатации

> [!Удобство эксплуатации]
> Удобство эксплуатации - облегчение выполнения стандартных задач, благодоря чему обслуживающий персонал может сосредоточить усилия на чем-то более важном

Что для этого должно быть в системе:
- Хороший мониторинг
- Интеграции со стандартными утилитами
- Качественная документация
- Адекватное поведение по умолчанию
- Авто и ручное восстановление
- Предсказуемое поведение
### Простота
Системы должны быть простыми. Это ОЧЕНЬ важно. Чтобы система была простой, нудно использовать абстракции. Абстракции очень сильно упрощают систему. Но хорошую абстракцию найти не просто
### Возможность развития
Тут стоит помнить, что вероятность того, что в требованиях что-то изменится стремится к нулю