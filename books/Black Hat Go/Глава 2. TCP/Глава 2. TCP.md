[[Black Hat Go]]

## TCP
TCP - это протокол транспортного уровня. Он отвечает за передачу данных. Для передачи данных клиент и сервер должны установить TCP соединение. Установка осуществляется в 3 этапа - 3 handshake.
![[Pasted image 20241031163839.png]]
Клиент и сервер обмениваются специальными пакетами. 
- `syn` - отправляет клиент для определения начала сеанса
- `syn-ack` - отправляется сервером, как способ подтверждения пакета `syn`
- `ack` - отправляется клиентом. Соединение установлено

Если же порт закрыт, сервер ответит пакетом `rst`. Когда же трафик филтруется брэндмауэром, то клиент не получает пакетов от сервера.

## Переадресация портов
Переадресация портов - это техника, которая используется для обхода блокировки какого-то порта.
Например, сеть блокирует сайт `evil.com`. Но мы можем подключиться к нему с помощью проксирования.
![[Pasted image 20241031164417.png]]
Можно настроить доступный хост (stacktitan.com) для того, чтобы он перенаправлял соединений к хосту evil.com
## TCP-сканнер
Код находится в файле `scanner.go`. Основное, что тут нужно пояснить - конкурентная модель. Здесь используются воркеры. Для синхронизации горутин используется буферизированный канал. 
`net.Dial` - создает клиента, который может устанавливать `tcp` соединение

## Эхо-сервер
Код находится в `echo.go`. 
Важное уточнение - `io.Copy` блокирует весь поток данных, пока соединение открыто. Функция будет висеть и ждать, копировать данные, пока они идут. Чтобы можно было обрабатывать каждый пакет данных отдельно, нужно читать данные последовательно.
## TCP-прокси
Код находится в `./proxy`. `./proxy/server` - сервер, доступ к которому мы хотим получить через проксирование. `./proxy/proxy` - сервер-прослойка, которая переадресует запросы на заблокированный сервер
Чтобы проверить как оно работает:
- Запустить сервер-цель: `go run server/server.go`
- Запустить прокси-сервер: `go run proxy/proxy.go`
- Отправить `GET` запрос: ` curl -i -X GET http://localhost:5353`

`http.ListenAndServe` - создает http-сервер
`net.Listen` - создает tcp-сервер

## Удаленное выполнение команд
Код лежит в `nc.go`, сервер-подопытный -- `./proxy/server`. По сути мы перенаправляем все исходящие данные в bash консоль.
![[Pasted image 20241031170607.png]]
Штука опасная. Пока что жду, когда люди в чате помогут: когда такая дыра вообще появляется?
Я придумал только случай с интерактивными платформами по типу Replit