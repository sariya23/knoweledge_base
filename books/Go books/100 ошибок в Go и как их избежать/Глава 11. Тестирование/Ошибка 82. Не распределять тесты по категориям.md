[[100 ошибок в Go и как их избежать]]

Есть несколько механизмов, чтобы относить тест в какую-то категорию
## Теги-сборки
Наиболее частый метод классификации тестов - теги сборки. Тег сборки - это спец. комментарий в начале файла Go
```go
//go:build foo 

package bar
```
В одном пакете могут быть файлы с разными тегами сборки. Теги сборки используются в двух случаях:
- Для сборки приложения
- Классификация тестов

Например, мы хотим разделить интеграционные тесты
```go
//go:build integration
package test

import (
    "main/tags"
    "testing"
)

func TestAddA(t *testing.T) {
    res := tags.Add(2, 2)
    if res != 4 {
        t.Errorf("erro")
    }
}
```
Мы пометили этот файл тегом `integration`. Предположим в пакете 2 тестовых файла. Файл с тегом `integration` и просто тестовый файл без тега сборки. Если мы запустим тесты командой
```shell
go test -v .
```
То запустятся файлы только без тега сборки. Если же мы добавим флаг:
```shell
go test --tags=integration -v .
```
То запустятся файлы и с тегом и без него. Чтобы сделать так, чтобы запускались только интеграционные тесты, нужно добавить в файл с юнит тестами следующий тег сборки:
```go
//go:build !integration
```
То есть мы тегируем его как NOT integration. 

## Переменные среды
У тегов сборки есть недостаток: нет сигнала о том, какой тест проигнорирован. Мы можем явно скипать какие-то тесты, если у переменной окружения какое-то специальное значение.
```go
func Test(t *testing.T) {
	if os.Getenv("integraion") == "false" {
		t.Skip("skipping integration test")
	}
}
```
Тесты будут пропускаться в явном виде
```shell
$ go test -v . 
=== RUN TestInsert 
	db_integration_test.go:12: skipping integration test 
--- SKIP: TestInsert (0.00s) 
=== RUN TestUnit 
--- PASS: TestUnit (0.00s) 
PASS 
ok db 0.319s
```
## Короткий режим
Мы можем классифицировать тесты по скорости выполнения. Например, у нас есть юнит тесты, но один из них проходит очень долго. При быстром режиме мы бы хотели его пропускать. Это можно сделать так:
```go
func TestLongUnit(t *testing.T) {
	if testing.Short() {
		t.Skip("skipping long test")
	}
}
```
Чтобы запустить тесты в быстром режиме, мы должна добавить флаг `-short`
```shell
go test -short -v .
```