[[100 ошибок в Go и как их избежать]]

## Флаг parallel
В тест можно добавить метку, чтобы он выполнялся параллельно с *остальными* параллельными тестами.
```go
func TestFoo(t *testing.T) {
	t.Parallel()
}
```
Когда мы помечаем тест как `t.Parallel`, он выполняется одновременно со всеми другими параллельными тестами. Но с точки зрения организации исполнения кода Go сначала запустит последовательные тесты один за другим, а потом начнет выполнять параллельные
```go
func TestA(t *testing.T) {
	t.Parallel()
}

func TestB(t *testing.T) {
	t.Parallel()
}

func TestC(t *testing.T) {
	// ..
}
```
```shell
=== RUN   TestA
=== PAUSE TestA
=== RUN   TestB
=== PAUSE TestB
=== RUN   TestC
--- PASS: TestC (0.00s)
=== CONT  TestA
--- PASS: TestA (0.00s)
=== CONT  TestB
--- PASS: TestB (0.00s)
PASS
```
Видно, что параллельные тесты регистрируются первее последовательных, но сразу же паузятся. Они начинают выполняться только после того, как пройдут последовательные тесты

Кол-во параллельных тестов определяется переменной `GOMAXPROCS`. При запуске тестов это можно поменять:
```shell
go test -parallel 16 .
```

## shuffle
При запуске тестов с флагом `shuffle`
```shell
go test -shuffle=on -v .
```
Тесты будут запускаться каждый раз в рандомном порядке. Если нам нужно как получить сид генерации, он будет выведен при запуске в verbose (`-v`) режиме. Потом этот сид можно скопировать, чтобы тесты запускались в таком же порядке
```shell
go test -shuffle=<seed> -v .
```