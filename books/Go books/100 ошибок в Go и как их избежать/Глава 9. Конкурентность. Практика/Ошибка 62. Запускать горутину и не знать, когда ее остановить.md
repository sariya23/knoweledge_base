[[100 ошибок в Go и как их избежать]]

Максимальный размер стека для 64х ОС 1Гбайт и 250Мбайт для 32х ОС. При утечке горутин утекает память не только под эту горутину, но и ресурсы которые в ней остаются.

Рассмотрим приложение, которое отслеживает некую внешнюю активность:
```go
func main() {
	newWatcher()
}
type watcher struct {}
func newWatcher() {
	w := watcher{}
	go w.watch()
}
```
Проблема с этим кодом в том, что при выходе из основной горутины, ресурсы, созданные в `watcher` не закрываются корректно.
Один из вариантов решения этой проблемы - передача родительского контекста:
```go
func main() {
	ctx, cancel := context.WithCanclel(context.Background())
	defer cancel()
	newWatcher(ctx)
}
func newWatcher() {
	w := watcher{}
	go w.watch(ctx)
}
```
Структура `watcher` должна закрывать свои ресурсы после отмены контекста. Но если гарантия, что на успеет это сделать? Нет. Исправим это:
```go
func main() {
	w := newWatcher{}
	defer w.close()
}
func newWatcher() {
	w := watcher{}
	go w.watch()
	return w
}
func (w watcher) close() {
	// ...
}
```

> ***ВСЯКИЙ РАЗ, КОГДА ГОРУТИНА ЗАПУСКАТЕСЯ, ВЫ ДОЛЖНЫ ЧЕТКО ПОНИМАТЬ, КОГДА ОНА ОСНОВИТСЯ***

