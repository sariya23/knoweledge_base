[[Go]]
## Локальные пакеты
Первый раз пытаясь написать приложение, я очень много времени убил на то, чтобы импортировать локальные пакеты. Может я дурак, но работа с этими пакетами тут капец какая неудобная. В python с этим в 10000000 раз проще.
### Шаг 1. Определение `go.mod`
Для начала нужно создать файл `go.mod` с помощью команды `go mod init module_name`. Версия туда подставиться автоматически:
``` go
module my_module

go 1.22.5
```

## Шаг 2. Создание пакета
Теперь создаем каталог и в нем уже делаем грязь. Все, что в этом каталоге будет новым пакетом. Главное, дать ему другое имя
```go
package format

import "fmt"

func UserName(userName string) string {
    return fmt.Sprintf("!%s!", userName)
}
```
```
```

```
.
├── format
│   └── format.go
├── go.mod
└── main.go
```
`format` - это пакет. Чтобы использовать его в пакете `main` нужно его импортировать.

## Импорт пакета
```go
package main

import (
    "fmt"
    "my_module/format"
)

func main() {
    fmt.Println(format.UserName("aboba")) // !aboba!
}
```


## Репозитории, модули, пакеты
Репозиторий - место, где лежат модули. Модуль - набор пакетов. Пакет - это набор функций для чего-то.
![[Pasted image 20240807210150.png]]
В данном случае модуль это `ch9`, а в нем есть пакет `my_math`. 

## Файл `go.mod`
Если в каталоге есть файл `go.mod`, то он становится модулем. Чтобы инициализировать этот файл:
```bash
go mod init path/to/module
```
Файл `go.mod` из скрина выше
```go
module ch9

go 1.22.5
```
Так же если есть какие-то сторонние зависимости, то они тоже указываются здесь в инструкции `require`
```go
require (
	github.com/.../...
)
```

## Импорт и экспорт
Когда мы импортируем какой-то пакет, то в наше пространство имен добавляются константы, переменные и все-все из этого пакета. Только если оно экспортируемое. В Go если вообще все что угодно начинается с маленькой буквы - не экспортируемая сущность. С большой - экспортируемая.

## Именование пакетов
Название каталога и пакета - разные вещи. Главное, что указано в инструкции `package`.
Пакет лучше именовать осмыслено. Так как всегда доступ к функциям будет доступен только через имя пакета, лучше делать так, что его название сочеталось с сущностями, которые в нем есть.

## Переопределение имени пакета
Может быть такое, что два пакета будут называться одинаково. Если так вышло, то можно задать одному из них другое имя
```go
import (
	"fmt"
	crand "crypto/rand"
	"math/rand"
)
```
Можно также импортировать все из пакета и дальше не указывать его имя:
```go
import (
	. "fmt"
)
```
Если нужен модуль только для того, чтобы в нем выполнился файл init, то можно использовать пустой импорт:
```go
import (
	_ "smthpkg"
)
```
## Комментарии пакета и `godoc`
В Go есть специальный формат для составление документации - godoc.
Вот правила по написанию документации:
- Комментарии надо размещать перед сущностью, которую документируем
- В начале комментария должно быть имя того, что документируем
- Комментарии можно разбивать на несколько абзацев с помощью пустого комментария
Если дока занимает очень много места, то лучше ее вынести в файл `doc.go` в каталоге пакета

Всю доку пакета можно увидеть с помощью `go doc package_name`
```
nikita:ch9/ $ go doc my_math                                                                                                                          [21:01:35]
package my_math // import "ch9/my_math"

my_math позволяет делать крутые штуки

func Add(a, b int) int
```

## Пакет internal
Если нам нужно сделать какие-то функции доступными для пакетов и модулей, но не доступной для публичного API, нужно их помещать в пакете `internal`. Данные в этом пакете будут доступны только для пакетов того же уровня и его родительского пакета.

## Функция `init` (не использовать)
В пакете можно определить функцию `init` без входных и выходных параметров - она будет выполнятся при первом обращении к пакету. То есть она может делать только побочные эффекты. Их даже может быть несколько.