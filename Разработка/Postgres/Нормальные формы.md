[[Postgres]]
Нормализованная схема БД нужна, чтобы избегать избыточности информации. Но также данные иногда нужно денормализовывать, чтобы ускорить запросы. Но проектирование всегда нужно начинать со схем в нормальных формах
## 1 НФ
В колонке хранятся атомарные значения. То есть если в какой-то колонке лежит список значений, jsonb или array, то таблице не в 1 НФ. Вот, например

| order_id | created_at | products |
| -------- | ---------- | -------- |
| 1        | 2024-04-04 | 10,15,20 |
| 2        | 2024-05-12 | 20,40    |
Тут в колонке products хранится список значений. Чтобы привести эту таблицу в 1 НФ нам нужно избавиться от этого списка
Таблица order

| order_id | created_at |
| -------- | ---------- |
| 1        | 2024-04-04 |
| 2        | 2024-05-12 |
Таблица cart

| order_id | product_id | q   | price |
| -------- | ---------- | --- | ----- |
| 1        | 10         | 1   | 1000  |
| 1        | 15         | 1   | 265   |
| 1        | 20         | 2   | 134   |
| 2        | 20         | 1   | 77    |
| 2        | 40         | 3   | 900   |
Теперь таблица в 1 НФ
## 2 НФ
- Таблица должна быть в 1 НФ
- В таблице не должно быть зависимости какого-то столбца только от части ПК
Есть такая таблица

| order_id | product_id | name  | q   | price |
| -------- | ---------- | ----- | --- | ----- |
| 1        | 20         | Apple | 2   | 100   |
| 1        | 14         | Grape | 100 | 500   |
Здесь ПК - order_id + product_id. Но колонка name зависит только от product_id, но никак не от order_id. Фикс
Создаем отдельную таблицу товары

| product_id | name  | price |
| ---------- | ----- | ----- |
| 20         | Apple | 50    |
| 14         | Grape | 5     |
И корзину

| order_id | product_id | q   | price |
| -------- | ---------- | --- | ----- |
| 1        | 20         | 2   | 100   |
| 2        | 14         | 100 | 500   |
## 3 НФ
- Таблица должна находится во 2 НФ
- Отсутсвует транзитивная зависимость
Транзитивная зависимость - это когда какая-то колонка зависит не от ПК, а от другой колонки. Например

| order_id | created_at | del_method | del_name |
| -------- | ---------- | ---------- | -------- |
| 1        | 2024-09-09 | 1          | Почта РФ |
Тут колонка del_name зависит не от ПК (order_id), а от другой колонки - del_method.
Фикс

| del_method | del_name |
| ---------- | -------- |
| 1          | Почта РФ |

| order_id | created_at | del_method |
| -------- | ---------- | ---------- |
| 1        | 2024-09-09 | 1          |
