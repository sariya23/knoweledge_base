[[Postgres]]

Транзакция - это атомарный набор операций. Выполняются либо все операции, либо ни одна. Транзакции позволяют следить за согласованностью данных.
Предположим, когда мы сохраняем нового юзера, мы добавляем запись о нем во множество таблиц: `user_role`, `user_profile`, `user_settings`. Чтобы не было ситуации, что юзер добавился в одну таблицу, а в другие нет, стоит использовать транзакции.
```sql
begin;

update account set balance -= 1000 where id=2;

commit;
```
Транзакция обрамляется командами `commit` и `begin`, либо `rollback`, если мы не хотим применять изменения
```sql
begin;

update account set balance -= 1000 where id=2;
savepoint save1;

update account set balance += 1000 where id=1;
savepoint save2;

commit;
```
## ACID
- **A**tomacity (Атомарность) - транзакция либо выполняется полностью, либо не выполняется вообще
- **C**onsistency (Согласованность) - после успешного выполнения транзакции или ее отката ограничения БД должны также действовать. Речь идет именно об ограничениях на уровне БД, т.е разные констрейнты: primary key, foreign key, check, not null, unique. У нас могут быть ограничения на уровне бизнес-логики, но это уже не относится к слою БД
- **I**solation (Изолированность) - транзакции при одновременной выполнении не должны оказывать друг на друга влияния
- Durability (Долговечность) - после выполнения транзакции данные надежно сохраняются на диске.